---
tags: [lua, microservice, selfhosted]
---

# Self-Hosted Long Polling –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å. –ó–∞—á–µ–º –∏ –∫–∞–∫

![banner](banner.png)

:::note

–≠—Ç–æ—Ç –ø–æ—Å—Ç ‚Äì –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–ø–∏—Å—å [–¥–≤—É—Ö](../../2021-11-15-poll-gmod-app-docs.md) [—Å—Ç–∞—Ä—ã—Ö](../../2021-03-08-webhook-bez-web-servera.md) –ø–æ—Å—Ç–æ–≤ –Ω–∞ —ç—Ç—É —Ç–µ–º—É.

:::

`poll.def.pm` ‚Äì —ç—Ç–æ –ø—Ä–æ—Å—Ç–µ–π—à–∏–π **[open-source](https://github.com/TRIGONIM/lua-long-polling)** Long Polling —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–≤–æ–µ–æ–±—Ä–∞–∑–Ω–æ–≥–æ WebHook —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ö—Ä–∞–Ω–∏—Ç –≤ —Å–µ–±–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ updates.

> üåà  –í—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å **–µ–¥–∏–Ω—ã–π –≤–µ–±—Ö—É–∫** url –Ω–∞ –≤—Å–µ—Ö API —Å–µ—Ä–≤–∏—Å–∞—Ö, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ, –∑–∞—Ç–µ–º –ø–æ–ª—É—á–∞—Ç—å —ç—Ç–∏ –≤–µ–±—Ö—É–∫–∏ —Å–æ —Å—Ç–æ–ª—å–∫–∏ —Å–≤–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–∫–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–¥–∏—Ç–µ.
>
> - **–í –ª—é–±–æ–µ –≤—Ä–µ–º—è**. –î–∞–∂–µ –µ—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–∏—Å –±—ã–ª offline, –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
> - **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ**. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–π –∞–ø–¥–µ–π—Ç, –≤—ã —Å—Ä–∞–∑—É –µ–≥–æ –ø–æ–ª—É—á–∞–µ—Ç–µ. –ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏
> - **–ë–µ–∑ —Å–ø–∞–º–∞ GET –∑–∞–ø—Ä–æ—Å–∞–º–∏**. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å long-polling –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–¥–µ—Ç –∞–ø–¥–µ–π—Ç.
> - **–ü–æ–ª—É—á–∞–µ—Ç–µ –≤–µ–∑–¥–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**. –ù–∞–ø—Ä–∏–º–µ—Ä —Ç–µ–ª–µ–≥—Ä–∞–º–æ–≤—Å–∫–∏–π `getUpdates` –∑–∞–ø—Ä–µ—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∞–ø–¥–µ–π—Ç—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö. –¢–∞–∫ –≤–∞—à –±–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

<!--truncate-->

–†–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ—á–µ—Å—Ç—å [—ç—Ç–æ](https://learn.javascript.ru/long-polling), –µ—Å–ª–∏ –≤—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç–µ LongPolling –∫–∞–∫ —Å–ø–∞–º GET –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—ç—Ç–æ –Ω–µ —Ç–∞–∫).

![scheme](scheme.png)
*–û–¥–Ω–æ–π —ç—Ç–æ–π —Å—Ö–µ–º—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∫–∞–∫ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Telegram –±–æ—Ç–∞*

## –ö–æ–º—É –∏ –∑–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª —Å–æ–∑–¥–∞–Ω, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—É—à —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–µ–±—Ö—É–∫–∏) –≤ Garry's Mod, –≥–¥–µ –Ω–µ–ª—å–∑—è –±—ã–ª–æ —Å–¥–µ–ª–∞—Ç—å –≤–µ–± —Å–µ—Ä–≤–µ—Ä.

–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–ø–¥–µ–π—Ç–æ–≤ —Å —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. **–° –Ω–∏–º –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–µ–± —Å–µ—Ä–≤–µ—Ä –ø–æ–¥ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å**, —á—Ç–æ –µ—â–µ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–µ–µ, –µ—Å–ª–∏ –∞–ø–¥–µ–π—Ç—ã –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

### –†–µ–∞–ª—å–Ω—ã–µ use-cases

–°–ø–∏—Å–æ–∫ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–Ω–µ –ø–æ–∫–∞–∑–∞–ª–∏—Å—å –ø–æ–ª–µ–∑–Ω—ã

<details>
<summary>üëâ –û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</summary>

#### –ú–æ–¥—É–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å

<!-- –£ –º–µ–Ω—è –µ—Å—Ç—å –∑–∞–±–∞–≤–Ω—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —è –ø–∏—Å–∞–ª –¥–ª—è Garry's Mod. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–¥–µ–ª–∞—Ç—å "–º–æ—Å—Ç" –º–µ–∂–¥—É –∏–≥—Ä–æ–≤—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –∏ —Ç–µ–ª–µ–≥—Ä–∞–º–æ–º. –° —Ç–µ–ª–µ–≥—Ä–∞–º–∞ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤, –∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ —á–∞—Ç —Ç–µ–ª–µ–≥—Ä–∞–º–∞ –∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä–∞. –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–¥ –±—ã–ª –∑–∞–ø—É—â–µ–Ω —Å—Ä–∞–∑—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö. -->

–≠—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ Telegram –±–æ—Ç–æ–≤, –ø—Ä–æ—Å—Ç–æ –º–Ω–µ —ç—Ç–æ –±–ª–∏–∂–µ –ø–æ –¥—É—Ö—É.

1. –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –í –±–æ—Ç–µ –±—ã–ª–∞ –∫–æ–º–∞–Ω–¥–∞ `/players`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏—Å—ã–ª–∞–ª–∞ —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤. –ö–∞–∂–¥—ã–π –±–æ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø–æ–ª—É—á–∞–ª —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –∏ –ø—Ä–∏—Å—ã–ª–∞–ª —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤. –ë—ã–ª–∞ –µ—â–µ –∫–æ–º–∞–Ω–¥–∞ `/select $servername`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–ª–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–µ—Ä–µ. **!BAN CHEATER**

2. –û–¥–Ω–∞ —á–∞—Å—Ç—å –±–æ—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ python, –¥—Ä—É–≥–∞—è –Ω–∞ lua. –ù–∞ –ø–∏—Ç–æ–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/computervision`, –Ω–∞ lua –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ. –Ø –ø—Ä–æ—Å—Ç–æ –≤—ã–Ω–µ—Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è –±—ã–ª–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞ Lua –≤ –¥—Ä—É–≥—É—é —Å—Ä–µ–¥—É. –ù–∞ Lua –Ω–µ –±—ã–ª–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞ —Ç–∞–∫–æ–π –∫–æ–º–∞–Ω–¥—ã, –∞ –Ω–∞ –ø–∏—Ç–æ–Ω–µ –Ω–µ –±—ã–ª–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥. –¢–∞–∫ —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–æ.

#### healthcheck

![Servers looks down](healthcheck.png)

–ü–æ–¥–æ–±–Ω–æ –º–æ–¥—É–ª—å–Ω–æ–º—É –±–æ—Ç—É, –º–æ–π healthcheck —Ä–∞–±–æ—Ç–∞–ª —Ç–∞–∫, —á—Ç–æ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–ª –¥—Ä—É–≥ –¥—Ä—É–≥–∞. –ù–∞ –æ–¥–Ω—É –ø–æ–ª–ª–∏–Ω–≥ —Å—Å—ã–ª–∫—É –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ —Å–∏–≥–Ω–∞–ª "—è $–∏–º—è –∏ —è –∂–∏–≤–æ–π". –ò –∫–∞–∂–¥—ã–π –ø–æ —Ç–∞–∫–æ–π –∂–µ —Å—Å—ã–ª–∫–µ –∑–Ω–∞–ª, –∫—Ç–æ –∂–∏–≤–æ–π. –ï—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–∞–¥–∞–ª, —Ç–æ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Å–æ–æ–±—â–∞–ª "—Ç—É—Ç —Å–µ—Ä–≤–∏—Å –ø–æ–≥–∏–±, –ø–æ–º–æ–≥–∞–π". –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª–æ—Å—å –≤—Å–µ —ç—Ç–æ –ø—Ä–æ—Å—Ç—ã–º –≤–∫–ª—é—á–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

#### –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

![–ø–µ—á–µ–Ω—å –æ—Ç–∫–∞–∑–∞–ª–∞](pechenka.png)
*–∑–∞—á–µ–º —è –≤—Å—Ç–∞–≤–∏–ª –∫–∞—Ä—Ç–∏–Ω–∫—É —Å –ø–µ—á–µ–Ω—å—é..?*

–ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä –¥–ª—è —Ç–µ–ª–µ–≥—Ä–∞–º, –Ω–æ –æ–Ω –ø—Ä–∏–º–µ–Ω–∏–º –¥–ª—è –ª—é–±–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

–ï—Å–ª–∏ –±–æ—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è, –∞ –ª—é–¥–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø–∏—Å–∞—Ç—å, —Ç–æ —Å –≤–µ–±—Ö—É–∫–æ–º –≤—ã –Ω–∞–≤—Å–µ–≥–¥–∞ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –° long-polling —Å–µ—Ä–≤–∏—Å–æ–º –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏–¥—É—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è.

#### luadev

–Ø [–ø–æ–¥—Ä–µ–¥–∞—á–∏–ª](https://github.com/AMD-NICK/vscode-gmod-luadev/commit/046a083257e90e28bb5273010f940603becd4edf) –æ–¥–∏–Ω –ø–ª–∞–≥–∏–Ω –¥–ª—è VSCode, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å Lua –∫–æ–¥ –ø—Ä—è–º–æ –≤ runtime —Å—Ä–µ–¥–µ –ª—é–±–æ–≥–æ –º–æ–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–ª–∞–≥–∏–Ω –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ long-polling. –í—Å–µ –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä–∞, –≤—Å–µ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç—ã –∏ –≤—Å–µ –≤–µ–± –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—É—á–∞–ª–∏ —ç—Ç–æ—Ç –∫–æ–¥ —á–µ—Ä–µ–∑ –æ–¥–Ω—É —Å—Å—ã–ª–∫—É. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –≥–¥–µ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ, —Ç–æ —è –ø—Ä–æ—Å—Ç–æ –≤ –Ω–∞—á–∞–ª–µ –ø–∏—Å–∞–ª —á—Ç–æ-—Ç–æ –Ω–∞ –ø–æ–¥–æ–±–∏–∏ `if not BOT_REPOSTER then return end`

#### –ß–∞—Ç

–ü—Ä–æ—Å—Ç–µ–π—à–∏–π —á–∞—Ç. –ù–∞ –≤–µ–± —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π js —á–∞—Ç–∏–∫. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å" –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è POST –Ω–∞ –ª–æ–Ω–≥-–ø–æ–ª–ª–∏–Ω–≥. –í—Å–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ–ª–∞—é—Ç GET + ?sleep=60 –∏ —Å—Ä–∞–∑—É –≤–∏–¥—è—Ç —Å—Ç–∞—Ä—ã–µ + –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

#### –†–∞–±–æ—Ç–∞ –≤ —Å—Ä–µ–¥–µ, –≥–¥–µ –Ω–µ–ª—å–∑—è –ø–æ–¥–Ω—è—Ç—å –≤–µ–± —Å–µ—Ä–≤–µ—Ä

–ú—ã –≤ `gm-donate.net` —Ä–∞–Ω—å—à–µ –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∏ –ª—é–¥—è–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å .dll –º–æ–¥—É–ª—å –Ω–∞ –∏—Ö —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ GMOD –Ω–µ–ª—å–∑—è –ø–æ–¥–Ω—è—Ç—å –≤–µ–± —Å–µ—Ä–≤–µ—Ä (–≤–µ–±—Ö—É–∫) –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–∏–∫–æ–ª—é—Ö. –°–µ–π—á–∞—Å –º—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—É—à–∏ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ long polling url, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –≤ Garry's Mod –æ—á–µ–Ω—å –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –∞–ø–¥–µ–π—Ç—ã.

</details>

## –ì–¥–µ —Å–∫–∞—á–∞—Ç—å, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å?

–í—ã –º–æ–∂–µ—Ç–µ –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π `poll.def.pm` –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –ª–∏–±–æ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ü–µ–ª—è—Ö, –ª–∏–±–æ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã.

–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –µ—Å—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub: [lua-long-polling](https://github.com/TRIGONIM/lua-long-polling).

–°–∞–º—ã–º –ø—Ä–æ—Å—Ç—ã–º self-hosted –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker:

```bash
docker run -p 3000:3000 ghcr.io/trigonim/lua-long-polling:latest
```

## API

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ú—ã —Ö–æ—Ç–µ–ª–∏ —Å–¥–µ–ª–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π API, –ø–æ—ç—Ç–æ–º—É –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤, –ø–∞—Ä–æ–ª–µ–π, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–º–∏ (–ª—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ—á–µ—Å—Ç—å –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å), –∫–∞–∫ –≤ blockchain. –í –±–ª–æ–∫—á–µ–π–Ω–µ –≤–∞—à–∞ –∑–∞—â–∏—Ç–∞ —ç—Ç–æ –≤–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á. –ó–¥–µ—Å—å —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ:

- ` GET https://poll.def.pm/SECRET_UID`
- `POST https://poll.def.pm/SECRET_UID`

–¢–æ–ª—å–∫–æ —Ç–æ—Ç, –∫—Ç–æ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å `SECRET_UID`, —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

### üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–ø–¥–µ–π—Ç–æ–≤

–í–æ—Ç –ø—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ `https://poll.def.pm/SECRET_UID`.

![](get_output.png)
*–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Å –ø–æ–ª—è–º–∏ ok, ts –∏ updates*

- `updates` —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ (—Å–ø–∏—Å–æ–∫) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ POST –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö. –î–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏: `curl -X POST -H "Content-Type application/json" -d '{"a": 1}' "https://poll.def.pm/SECRET_UID"`. –¢–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–µ–±—Ö—É–∫ —Ç–µ–ª–µ–≥—Ä–∞–º, –≤–∫, –≥–∏—Ç—Ö–∞–± –∏ –≤–æ–æ–±—â–µ –≤—Å–µ.
- `ts` —ç—Ç–æ "offset". –ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ ts = 21, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ `SECRET_UID` –ø–æ–ª—É—á–∏–ª 21 update. –ï—Å–ª–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö GET –∑–∞–ø—Ä–æ—Å–∞ —É–∫–∞–∑–∞—Ç—å `?ts=19`, —Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç 20–π –∏ 21–π update.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã GET –∑–∞–ø—Ä–æ—Å–∞

- `?ts=12345`. –û–ø–∏—Å–∞–Ω –≤—ã—à–µ, —Ä—è–¥–æ–º —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ–ª—è
- `&sleep=0`. default 0, max 60. –ï—Å–ª–∏ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ —É–∫–∞–∑–∞—Ç—å `ts=21` (—Ç.–µ. —Ç–µ–∫—É—â–µ–µ –∫–æ–ª-–≤–æ –∞–ø–¥–µ–π—Ç–æ–≤), —Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª–∏–±–æ —Å—Ä–∞–∑—É, –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∏—Ç 22–π –∞–ø–¥–µ–π—Ç, –ª–∏–±–æ –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`{ts = 21, updates = {}}`) —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥. **–≠—Ç–æ –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç Long Polling –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª–ª–∏–Ω–≥–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –≤—ã —Å–ø–∞–º–∏—Ç–µ —Å—Å—ã–ª–∫—É –∑–∞–ø—Ä–æ—Å–∞–º–∏**.

### üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ø–¥–µ–π—Ç–æ–≤

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –≤ —Å–µ—Ä–≤–∏—Å–µ, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É `https://poll.def.pm/ANY_SECRET`. –°–µ—Ä–≤–∏—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –≤–µ–±—Ö—É–∫–∏ POST –∑–∞–ø—Ä–æ—Å–æ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ `application/json`.

**–ù–æ –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫ —Å—Å—ã–ª–∫–µ –ª—é–±–æ–π –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω —Å –∞–ø–¥–µ–π—Ç–æ–º**. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ–±—ã—á–Ω–æ–º `POST poll.def.pm/SECRET_UID -d {"foo": "bar"}` updates –±—É–¥–µ—Ç `{..., {foo = "bar"}}`. –ü—Ä–∏ `POST poll.def.pm/SECRET_UID?any=value -d {"foo": "bar"}` updates —É–∂–µ –±—É–¥–µ—Ç `{..., {foo = "bar", any = "value"}}`.

–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –Ω–∞ –æ–¥–Ω—É —Å—Å—ã–ª–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–∏—Å–æ–≤, –ª–∏–±–æ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–æ–≤, –ª–∏–±–æ —á–µ–≥–æ —É–≥–æ–¥–Ω–æ. –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ "–∫–∞–∫ –µ—Å—Ç—å", —Ç–æ –≤—ã –Ω–µ –±—É–¥–µ—Ç–µ —Ä–∞–∑–ª–∏—á–∞—Ç—å, —á—Ç–æ –∞–ø–¥–µ–π—Ç –ø—Ä–∏—à–µ–ª –æ—Ç `telegram1_bot` –∏–ª–∏ –æ—Ç `telegram2_bot`. –ù–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤–µ–±—Ö—É–∫ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π `?appname=telegram1`, —Ç–æ –≤—ã –ª–µ–≥–∫–æ —Å–º–æ–∂–µ—Ç–µ –ø–æ–Ω—è—Ç—å, –∫—Ç–æ –ø—Ä–∏—Å–ª–∞–ª –∞–ø–¥–µ–π—Ç.

## –ì–æ—Ç–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã

- [–ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç](https://github.com/TRIGONIM/lua-long-polling/blob/main/lua/long-polling/client.lua), –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–∏—Å–∞–Ω –¥–ª—è —á–∏—Å—Ç–æ–≥–æ Lua, –Ω–æ –µ—Å—Ç—å:
- [–ê–¥–∞–ø—Ç–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞](https://github.com/TRIGONIM/lua-long-polling/blob/main/examples/garrysmod-client.lua), —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ Garry's Mod

–û—á–µ–Ω—å –ª–µ–≥–∫–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—ã –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –î–∞–∂–µ chatgpt —Å–ø—Ä–∞–≤–∏—Ç—Å—è, –ø—Ä–æ—Å—Ç–æ —Å–∫–∏–Ω—å—Ç–µ –µ–º—É lua –≤–µ—Ä—Å–∏—é –∏ —Å–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ –≤–∞—à —è–∑—ã–∫.

–ï—Å–ª–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ ‚Äì —Å–∫–∏–Ω—å—Ç–µ –≤ –õ–° –∏–ª–∏ issues, –±—É–¥—É —Ä–∞–¥ ‚ù§Ô∏è

## –î–∏—Å–∫–ª–µ–π–º–µ—Ä

–£–ø–æ–º—è–Ω—É—Ç—ã–µ `poll.def.pm` –∏ `poll.gmod.app` –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∫–∞–∫ "–¥–µ–º–æ" –≤–µ—Ä—Å–∏–∏ –ª–æ–Ω–≥ –ø–æ–ª–ª–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–∞. –ö–∞–∂–¥—ã–π –¥–æ–º–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —É–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç, –Ω–æ –Ω–∞ –Ω–∏—Ö –µ—Å—Ç—å —Ä–µ–π—Ç –ª–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –∞–ø–¥–µ–π—Ç–æ–≤. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≤–∞—à–∏—Ö –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –±—É–¥–µ—Ç –ª—É—á—à–µ –∑–∞—Ö–æ—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã —Å–Ω—è—Ç—å –ª–∏–º–∏—Ç—ã. **–Ø –Ω–µ –Ω–µ—Å—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –≤—ã —á—Ç–æ-—Ç–æ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ —è –æ—Ç–∫–ª—é—á—É –æ–¥–∏–Ω –∏–∑ –¥–æ–º–µ–Ω–æ–≤.**
